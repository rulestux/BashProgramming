## 104.3 Mounting and Unmounting Filesystems
__weight 3__


## Commands

### mount
- utilitário para montagem de sistemas de arquivos;
- sintaxe: ```# mount -t TYPE DEVICE MOUNTPOINT ```;
- usando apenas 'mount', retorna uma lista de todos os sistemas de arquivo montados;
- __opções:__
	- '-t' indica que o próximo dado é o tipo do sistema de arquivos:
		- '-t TYPE' retorna dispositivos montados com um tipo fornecido;
		- pode-se informar vários separados por vírgula;
	- '-a' monta todos os sistemas de arquivos listados em '/etc/fstab';
	- '-r' ou '-ro' monta como somente leitura;
	- '-w' ou '-rw' monta como gravável;
	- '-o' ou '--options' precede uma lista de opções de montagem separadas por vírgula;
		- 'atime' e 'noatime': habilita ou desabilita a informação de hora de acesso;
		- 'auto' e 'noauto': habilita ou desabilita a montagem automática com 'mount -a';
		- 'defaults': passa 'rw', 'suid', 'dev', 'exec', 'auto', 'nouser' e 'async' para mount
		- 'dev' e 'nodev': os dispositivos de caractere ou de bloco devem ou não ser interpretados;
		- 'exec' e 'noexec': permite ou não a execução de binários;
		- 'user' e 'nouser': permite ou não a montagem por um usuário comum;
		- 'group': permite montagem por usuário do mesmo grupo;
		- 'owner': permite montagem apenas ao proprietário do dispositivo;
		- 'ro' e 'rw': define montagem somente leitura ou gravável;
		- 'remount': tentar remontar um sistema de arquivos já montado, como em ```# mount -o remount,ro /dev/sdb1```, 
		em que o sistema de arquivos é montado novamente como somente leitura; pode ser usado o ponto de montagem: ```# mount -o remount,ro /mnt/data```
- para desmontar um sistema de arquivos, usa-se __unmount__, seguido pelo nome do dispositivo ou do ponto de montagem;
- __opções para umount:__
	- '-a' desmonta todos os sistemas de arquivos listados em '/etc/fstab';
	- '-f' força a desmontagem;
	- '-r' se o sistema de arquivos não puder ser desmontado, torna-o somente leitura.
	
### lsof
- utilitário que, seguido do nome do dispositivo que contém um sistema de arquivos que não pôde ser desmontado, 
lista os arquivos que estão sendo usados nesse sistema de arquivos e quais processos os estão usando.
```$ lsof /dev/sdd2 ```

### lsblk
- utilitário que lista os sistemas de arquivos;
- a opção '-f' seguida do caminho de uma partição retorna as seguintes informações:
	- NAME: nome do dispositivo que contém um sistema de arquivos;
	- FSTYPE: tipo do sistema de arquivos;
	- LABEL: rútulo do sistema de arquivos;
	- UUID: identificador universal;
	- FSAVAIL: espaço disponível;
	- FSUSE%: porcentagem de uso;
	- MOUNTPOINT: onde é montado.

### blkid
- utilitário alternativo para exibir os sistemas de arquivos;
- com '-o list', os dados são organizados na tela.
	

## Files

### /etc/fstab
- arquivo que contém descrições sobre os sistemas de arquivos que podem ser montados;
- os campos do arquivo são: ```FILESYSTEM MOUNTPOINT TYPE OPTIONS DUMP PASS```
	- FILESYSTEM: dispositivo, UUID ou rótulo da partição, feito abaixo:
		- 'UUID=6e2c12e3-472d-4bac-a257-c49ac07f3761' ou
		- 'LABEL=homedisk'
	- MOUNTPOINT: onde o sistema de arquivos é montado;
	- TYPE: tipo do sistema de arquivos;
	- OPTIONS: opções de montagem que são passadas ao comando 'mount -o', conforme acima;
	- DUMP: indica se qualquer sistema de arquivos pode ser considerado para backup com dump; normalmente o valor é 0;
	- PASS: uma vez diferente de zero, define a ordem na qual os sistemas de arquivos são checados na inicialização;
	
### /etc/systemd/system/
- diretório que contém arquivos '__\*.mount__' em que se pode configurar o comportamento de sistemas de arquivos no systemd;
- a estrutura do arquivo segue o padrão:

```
[Unit]
Description=

[Mount]
What=
Where=
Type=
Options=

[Install]
WantedBy=
```
-
	- 'Description=' breve descrição da unidade de montagem;
	- 'What=' o que deveser montado, especificado com: ```/dev/disk/by-uuid/UUID```;
	- 'Where=' o caminho onde deve ser montado;
	- 'Type=' o tipo do sistema de arquivos;
	- 'Options=' opções para mount ou do '/etc/fstab';
	- 'WantedBy=' normalmente, ```multi-used.target```;
	- o nome do arquivo deve seguir o padrão do caminho para o diretório de montagem, por exemplo: 'mnt-device.mount';

- quando o arquivo é criado, reinicia-se o daemon do systemd com:
```
# systemctl daemon-reload
# systemctl start mnt-device.mount
```
- para habilitar para todas as inicializações: ```# systemctl enable mnt-device.mount```;
- para verificar o status da montagem: ```# systemctl status mnt-device.mount```;
- para visualizar todas as unidades de montagem: ```# systemctl list-units --type=mount```;

__montagem automática__
- criam-se arquivos '__\*.automount__' quando se deseja montar automaticamente quando um ponto de montagem é acessado;
- a estrutura do arquivo segue o padrão:

```
[Unit]
Description=

[Automount]
Where=

[Install]
WantedBy=multi-user.target
```
- o arquivo deve ser nomeado e ativado de modo análogo ao arquivo anterior.